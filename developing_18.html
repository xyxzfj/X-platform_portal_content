<!doctype html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>数据网络和数据通讯</title>
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="css/templete.css" type="text/css" media="all" />
    <meta charset="UTF-8">
</head>
<body class="level-2">
    <div class="wrapper">
        <!--Begin header-->
        <div class="header">
            <div class="grid-container clearfix">
                <div class="header-left">
                    <img alt="Microsoft" src="http://i.s-microsoft.com/global/ImageStore/PublishingImages/logos/hp/logo-lg-1x.png" width="94" height="20">
                    <h1>X-Platform</h1>
                </div>
                <div id="mscom-search" class="mscom-search" style="margin-top: 37px;">
                    <div class="search-form">
                        <form action="" id="search-form">
                            <div class="input-wrapper">
                                <label class="screen-reader-text" for="search-input">搜索 Microsoft.com</label>
                                <input id="search-input" type="text" class="input-area" autocomplete="off">
                            </div>
                            <button class="search-submit" id="search-btn" type="submit">
                                <img width="16" height="16" alt="Submit" src="http://i.s-microsoft.com/global/imagestore/PublishingImages/sprites/search-button-blue.png"></button>
                        </form>
                    </div>
                    <div class="search-results-box" id="results">
                        <div class="search-scope">
                            <ul>
                                <li class=""><a class="checked" search="microsoft" role="search">搜索 Microsoft.com</a></li>
                                <li class=""><a search="internet" role="search">搜索互联网</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--End header-->
        <br />
        <!--Begin Content-->
        <div class="content">
            <div class="wrapper">
                <div class="wrapper-header">
                    <div>
                        <a href="index.html">
                            <img src="./assets/image/banner_1.jpg"></a>
                    </div>
                </div>
                <div class="main">
                    <div class="nav">
                        <div class="block article-nav-block">
                            <h2>移动应用开发生命周期</h2>
                            <div class="menu">
                                <h3><a href="idea.html">计划<span>Idea/Planning</span></a></h3>
                                <ul>
                                    <li><a href="idea_01.html">平台总览</a></li>
                                    <li><a href="idea_02.html">开发工具、开发环境和模拟器</a></li>
                                    <li><a href="idea_03.html">应用结构和生命周期</a></li>
                                </ul>
                            </div>
                            <div class="menu">
                                <h3><a href="design.html">设计<span>Design</span></a></h3>
                                <ul>
                                    <li><a href="design_01.html">UI Layout的设计</a></li>
                                    <li><a href="design_02.html">UI的控件</a></li>
                                    <li><a href="design_03.html">UI页面的控制和导航</a></li>
                                    <li><a href="design_04.html">不同屏幕尺寸和分辨率的适配</a></li>
                                    <li><a href="design_05.html">第三方SDK</a></li>
                                    <li><a href="design_06.html">游戏开发</a></li>
                                </ul>
                            </div>
                            <div class="menu active">
                                <h3><a href="developing.html">开发<span>Developing</span></a></h3>
                                <ul>
                                    <li><a href="developing_01.html">开发语言</a></li>
                                    <li><a href="developing_02.html">Audio、Video Player应用的开发</a></li>
                                    <li><a href="developing_03.html">General APIs Mapping</a></li>
                                    <li><a href="developing_04.html">IAP应用内支付</a></li>
                                    <li><a href="developing_05.html">LBS应用</a></li>
                                    <li><a href="developing_06.html">LBS、镜头和传感器应用接口使用</a></li>
                                    <li><a href="developing_07.html">Native Code（C和C++）支持</a></li>
                                    <li><a href="developing_08.html">Push Notification</a></li>
                                    <li><a href="developing_09.html">Sharing in Social Network</a></li>
                                    <li><a href="developing_10.html">Source Code Control</a></li>
                                    <li><a href="developing_11.html">UI上的Data Binding</a></li>
                                    <li><a href="developing_12.html">Windows 8.1和WP 8 Sharing应用分享功能实现</a></li>
                                    <li><a href="developing_13.html">多媒体</a></li>
                                    <li><a href="developing_14.html">后台任务和多任务处理</a></li>
                                    <li><a href="developing_15.html">获取后台服务器数据</a></li>
                                    <li><a href="developing_16.html">浏览器控件WebView</a></li>
                                    <li><a href="developing_17.html">数据库（SQLite）</a></li>
                                    <li><a href="developing_18.html">数据网络和数据通讯</a></li>
                                    <li><a href="developing_19.html">通话和短信功能</a></li>
                                    <li><a href="developing_20.html">图形处理(Drawing & Animation)</a></li>
                                    <li><a href="developing_21.html">文件系统和应用设置</a></li>
                                    <li><a href="developing_22.html">应用间通信</a></li>
                                    <li><a href="developing_23.html">支付方式</a></li>
                                    <li><a href="developing_24.html">Windows 8.1应用外设开发</a></li>
                                </ul>
                            </div>
                            <div class="menu">
                                <h3><a href="testing.html">测试<span>Testing</span></a></h3>
                                <ul>
                                    <li><a href="testing_01.html">Windows 8 and WP 8开发FAQ</a></li>
                                </ul>
                            </div>
                            <div class="menu last">
                                <h3><a href="distribute.html">发布<span>Distribute</span></a></h3>
                                <ul>
                                    <li><a href="distribute_01.html">应用商店(发布和更新应用)</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="block success-story-nav-block">
                            <h2>成功案例</h2>
                        </div>
                        <div class="block others">
                            <a href="sample_code.html" class="left">示例代码</a>
                            <a href="http://msdn.microsoft.com/zh-cn/dn473954" class="right">教学视频</a>
                        </div>
                    </div>
                    <div class="content">
                        <h3 class="title">Data Network &amp; Connectivity<span><a href="index.html">返回首页&gt;</a></span></h3>
                        <div class="article-content">
                            <div class="WordSection1">
                                <p class="MsoToc1" style='layout-grid-mode: char'><a href="#_Toc372744246">一、网络信息</a></p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744247">获取网络状态信息</a>
                                </p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744248">获取套接字的连接信息</a>
                                </p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744249">检测网络更改</a>
                                </p>
                                <p class="MsoToc1" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744250">蓝牙</a>
                                </p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744251">蓝牙API 3</a>
                                </p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744252">代码示例</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744253">连接到对等方应用</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744254">连接到设备</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744255">侦听连接请求</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744256">检测手机上的蓝牙无线电状态。</a>
                                </p>
                                <p class="MsoToc1" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744257">邻近感应</a>
                                </p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744258">邻近感应
API 6</a>
                                </p>
                                <p class="MsoToc2" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744259">应用场合</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744260">1、企业中的应用</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744261">2、与零售购物体验</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744262">3、与市场营销</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744263">4、设备之间共享</a>
                                </p>
                                <p class="MsoToc3" style='layout-grid-mode: char'>
                                    <a
                                        href="#_Toc372744264">5、安防领域应用</a>
                                </p>
                                <p class="MsoToc2"><a href="#_Toc372744265">代码示例</a></p>
                                <p class="MsoToc3"><a href="#_Toc372744266">发送和接收 NFC 消息</a></p>
                                <p class="MsoToc3"><a href="#_Toc372744267">查找 Windows Phone 对等方应用</a></p>
                                <p class="MsoToc2"><a href="#_Toc372744268">如何确定是否支持邻近功能</a></p>
                                <p class="MsoToc2"><a href="#_Toc372744269">使用邻近感应激活应用</a></p>
                                <br />
                            </div>
                            <div class="WordSection2">
                                <h1><a name="_Toc372744246">一、网络信息</a></h1>
                                <p>在Android中通过ConnectivityManager来判断网络连接状态，如监听手机网络状态（包括GPRS，WIFI，&nbsp;UMTS等)；手机状态发生改变时，发送广播；当一个网络连接失败时进行故障切换；为应用程序提供可以获取可用网络的高精度和粗糙的状态。在Windows Phone中提供了Microsoft.Phone.Net.NetworkInformation 命名空间来获取网络信息。</p>
                                <h2><a name="_Toc372744247">获取网络状态信息</a></h2>
                                <p>
                                    对于Windows
Phone应用程序
                                </p>
                                <p>Microsoft.Phone.Net.NetworkInformation 命名空间提供DeviceNetworkInformation类来了解手机的网络状态信息。下表列出了可用的属性： </p>
                                <table>
                                    <tr>
                                        <td>
                                            <p>CellularMobileOperator</p>
                                        </td>
                                        <td>
                                            <p>确定移动运营商</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>IsNetworkAvailable</p>
                                        </td>
                                        <td>
                                            <p>指示网络是否可用</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>IsCellularDataEnabled</p>
                                        </td>
                                        <td>
                                            <p>指示网络是否启用了蜂窝数据</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>IsCellularDataRoamingEnabled</p>
                                        </td>
                                        <td>
                                            <p>指示网络是否允许数据漫游</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>IsWiFiEnabled</p>
                                        </td>
                                        <td>
                                            <p>指示是否启用了 Wi-Fi</p>
                                        </td>
                                    </tr>
                                </table>
                                <br />
                                <p>
                                    对于Windows
Store应用程序
                                </p>
                                <p>NetworkInformation.GetInternetConnectionProfile()可以获取本地计算机上当前建立的配置文件列表。</p>
                                <pre><code>var ConnectionProfiles = NetworkInformation.GetConnectionProfiles();</code></pre>
                                <p>从ConnectionProfile中，可以访问以下网络连接信息：</p>
                                <table>
                                    <tr>
                                        <td>
                                            <p>连接成本</p>
                                        </td>
                                        <td>
                                            <p>ConnetionCost</p>
                                        </td>
                                        <td>
                                            <p>提供连接成本详细信息，包括数据限制和漫游信息。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>成本类型</p>
                                        </td>
                                        <td>
                                            <p>NetworkCostType</p>
                                        </td>
                                        <td>
                                            <p>指示连接目前所用的网络的成本类型。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>数据计划状态与使用情况</p>
                                        </td>
                                        <td>
                                            <p>DataPlanStatus</p>
                                            <p>DataPlanUsage</p>
                                        </td>
                                        <td>
                                            <p>提供连接所关联的数据计划的具体使用信息。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>本地使用情况</p>
                                        </td>
                                        <td>
                                            <p>NetworkUsage</p>
                                        </td>
                                        <td>
                                            <p>提供本地连接的使用信息。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>网络适配器</p>
                                        </td>
                                        <td>
                                            <p>NetworkAdapter</p>
                                        </td>
                                        <td>
                                            <p>标识可为连接提供连接功能的网络适配器。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>WLAN和WWAN连接属性</p>
                                        </td>
                                        <td>
                                            <p>WlanConnectionProfileDetails</p>
                                            <p>WwanConnectionProfileDetails</p>
                                        </td>
                                        <td>
                                            <p>提供特定于WLAN和WWAN连接配置文件的其他详细信息。</p>
                                        </td>
                                    </tr>
                                </table>
                                <br />
                                <p>对于Android应用程序，可以使用NetworkInfo类的getActiveNetworkInfo()来获取一个当前网络连接状态的实例，并返回相应的结果。</p>
                                <p>对于IOS，将Reachability.h和Reachability.m加到自己的项目中，并引用SystemConfiguration.framework就可以使用，其中定义了三种网络状态：无连接、使用3G/GPRS网络、使用WiFi网络。</p>
                                <h2><a name="_Toc372744248">获取套接字的连接信息</a></h2>
                                <p>
                                    对于Windows
Phone应用
                                </p>
                                <p>
                                    套接字使用System.Net.Socket
API，Microsoft.Phone.Net.NetworkInformation
命名空间Socket的GetCurrentNetworkInterface() 方法可获取Windows Phone设备的网络套接字链接信息。详细信息请参见<a
    href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/hh202874(v=vs.105).aspx">Windows
Phone 套接字</a>。
                                </p>
                                <p>
                                    对于Windows
Store应用
                                </p>
                                <p>
                                    使用Windows.Networking.Sockets命名空间中的功能以及Windows应用商店中的TCP或UDP套接字发送和接受数据，其主要接口要DatagramSocket、StreamSocket和StreamSocketListener。并有许多支持类配合他们使用，详细信息请参见<a
                                        href="http://msdn.microsoft.com/en-us/library/windows/apps/hh452976.aspx">Windows商店应用的套接字</a>。
                                </p>
                                <p>对于Android应用，可以使用Java.Net.Socket中的接口获取套接字相关信息，对于IOS应用，可以导入头文件sys/socket.h、netinet/in.h、arpa/inet.h、unistd.h并获取套接字信息。</p>
                                <h2><a name="_Toc372744249">检测网络更改</a></h2>
                                <p>
                                    对于Windows
Phone应用
                                </p>
                                <p>
                                    可以通过注册
NetworkAvailabilityChanged 事件监听网络可用性的更改。
                                </p>
                                <p>
                                    对于Windows
Store应用
                                </p>
                                <p>
                                    可以通过注册<a
                                        href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.networking.connectivity.networkinformation.networkstatuschanged.aspx">NetworkStatusChanged</a>事件监听网络可用性的更改。
                                </p>
                                <p>对于Android应用，可以使用下列方法来检测网络情况</p>
                                <pre><code>private boolean checkNetwork() {
        ConnectivityManager conn = (ConnectivityManager) getSystemService(Context.CON
NECTIVITY_SERVICE);
        NetworkInfo net = conn.getActiveNetworkInfo();
        if (net != null && net.isConnected()) {
            return true;
        }
        return false;
    }</code></pre>
                                <p>对于IOS应用，使用下列方法来检测网络连接情况：</p>
                                <pre><code>Reachability *r = [Reachability reachabilityWithHostName:@“www.apple.com”];
switch ([r currentReachabilityStatus]) {
    case NotReachable:
        // 没有网络连接
        break;
    case ReachableViaWWAN:
        // 使用3G网络
        break;
    case ReachableViaWiFi:
        // 使用WiFi网络
        break;
}</code></pre>
                                <h1><a name="_Toc372744250">蓝牙</a></h1>
                                <p>
                                    在Android系统中android.bluetooth.BluetoothDevice提供了获取蓝牙的信息和对蓝牙操作的API，在Windows Phone中提供了&nbsp;<a
                                        href="http://msdn.microsoft.com/zh-cn/library/windowsphone/develop/windows.networking.sockets.streamsocket.aspx">StreamSocket</a>&nbsp;和&nbsp;<a
                                            href="http://msdn.microsoft.com/zh-cn/library/windowsphone/develop/windows.networking.proximity.peerfinder.aspx">PeerFinder</a>Windows 运行时 API。
                                </p>
                                <p>Windows Phone 8 支持两种蓝牙方案：应用到应用，应用到设备。在每种方案中，都在应用或设备之间建立 StreamSocket 连接。</p>
                                <h2><a name="_Toc372744251">蓝牙API</a></h2>
                                <p>Android提供的蓝牙API</p>
                                <table>
                                    <tr>
                                        <td>
                                            <p>BluetoothAdapter</p>
                                        </td>
                                        <td>
                                            <p>代表本地蓝牙适配器</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothDevice</p>
                                        </td>
                                        <td>
                                            <p>代表了一个远端的蓝牙设备</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothSocket</p>
                                        </td>
                                        <td>
                                            <p>代表了一个蓝牙套接字的接口</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothServerSocket</p>
                                        </td>
                                        <td>
                                            <p>代表打开服务连接来监听可能到来的连接请求</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothClass</p>
                                        </td>
                                        <td>
                                            <p>描述了一个设备的特性（profile）或该设备上的蓝牙大致可以提供哪些服务(service)，但不可信</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothHeadset</p>
                                        </td>
                                        <td>
                                            <p>提供手机使用蓝牙耳机的支持</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothA2dp</p>
                                        </td>
                                        <td>
                                            <p>定义高品质的音频，可以从一个设备传输到另一个蓝牙连接</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>BluetoothProfile.ServiceListener</p>
                                        </td>
                                        <td>
                                            <p>已经连接到或从服务断开时通知BluetoothProfile IPX的客户时一个接口</p>
                                        </td>
                                    </tr>
                                </table>
                                <p>与Android的蓝牙API类似，Windows Phone提供了用于使用蓝牙设备的API，主要API如下表：</p>
                                <table>
                                    <tr>
                                        <td>
                                            <p>PeerFinder</p>
                                        </td>
                                        <td>
                                            <p>提供发现附近设备上的另一应用实例的能力，并在这些对等方应用之间建立套接字连接。对等方应用是运行在另一设备上的另一应用实例</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>PeerInformation</p>
                                        </td>
                                        <td>
                                            <p>包含标识对等应用或设备的信息</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>StreamSocket</p>
                                        </td>
                                        <td>
                                            <p>
                                                支持使用
  TCP 流套接字的网络通信
                                            </p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ConnectionRequestedEventArgs</p>
                                        </td>
                                        <td>
                                            <p>
                                                包含通过
  ConnectionRequested 事件传递给应用的属性
                                            </p>
                                        </td>
                                    </tr>
                                </table>
                                <h2><a name="_Toc372744252">代码示例</a></h2>
                                <p>下列代码示例显示了如何使用蓝牙 API 连接到对等方应用和设备、侦听连接请求和检查蓝牙可用性。</p>
                                <h3><a name="_Toc372744253">连接到对等方应用</a></h3>
                                <pre><code>async void AppToApp()
{
PeerFinder.Start();
var peers = await PeerFinder.FindAllPeersAsync();
    if (peers.Count == 0)
    {
    Debug.WriteLine("Peer not found.");
    }
    else
    {
    	PeerInformation selectedPeer = peers[0];
        var streamSocket = await PeerFinder.ConnectAsync(selectedPeer);
        DoSomethingUseful(streamSocket);
    }
}</code></pre>
                                <h3><a name="_Toc372744254">连接到设备</a></h3>
                                <p>
                                    可以使用
PeerFinder.FindAllPeersAsync 来发现已配对的设备。可以使用下表中的一个关键值对来设置 PeerFinder.AlternateIdentities：
                                </p>
                                <table>
                                    <tr>
                                        <td>
                                            <p>
                                                PeerFinder.AlternateIdentities[&quot;Bluetooth:Paired&quot;]
  = &quot;&quot;
                                            </p>
                                        </td>
                                        <td>
                                            <p>枚举所有已配对的设备。在此例中，PeerInformation.ServiceName 将为空。对许多设备而言，用于通信的蓝牙端口已执行硬编码，因此可以在 ConnectAsync 调用中直接使用。如果设备播发某项服务，则可以使用配对选项进行枚举，但是使用所需使用的服务的 GUID 来调用 ConnectAsync。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>
                                                PeerFinder.AlternateIdentities[&quot;Bluetooth:SDP&quot;]
  = &quot;&lt;SDP service guid&gt;&quot;
                                            </p>
                                        </td>
                                        <td>
                                            <p>查找使用服务发现协议 (SDP) 并通过既定 GUID 播发服务的设备。如果找到任何设备，则 PeerInformation.ServiceName 将等于您指定的 GUID。</p>
                                        </td>
                                    </tr>
                                </table>
                                <pre><code>private async void AppToDevice()
{
   PeerFinder.AlternateIdentities["Bluetooth:Paired"] = "";
   var pairedDevices = await PeerFinder.FindAllPeersAsync();
   if (pairedDevices.Count == 0)
   {
      Debug.WriteLine("No paired devices were found.");
   }
   else
   {
      PeerInformation selectedDevice = pairedDevices[0];
      StreamSocket socket = new StreamSocket();
      await socket.ConnectAsync(selectedDevice.HostName,"1");
      DoSomethingUseful(socket);
   }
}</code></pre>
                                <h3><a name="_Toc372744255">侦听连接请求</a></h3>
                                <pre><code>public MainPage()
{
InitializeComponent();
    Loaded += MainPage_Loaded;
}
void MainPage_Loaded(object sender, RoutedEventArgs e)
{
    PeerFinder.ConnectionRequested += PeerFinder_ConnectionRequested;
}
void PeerFinder_ConnectionRequested(object sender, ConnectionRequestedEventArgs args)
{
if (ShouldConnect())
{
ConnectToPeer(args.PeerInformation);
}    
}
async void ConnectToPeer(PeerInformation peer)
{
    StreamSocket socket = await PeerFinder.ConnectAsync(peer);
    DoSomethingUseful(socket); 
}
private bool ShouldConnect()
{
    return true;
}</code></pre>
                                <h3><a name="_Toc372744256">检测手机上的蓝牙无线电状态。</a></h3>
                                <p>当蓝牙关闭时，调用 FindAllPeersAsync 将引发异常。通常可通过使用下列代码捕捉此异常来检测到手机上蓝牙的关闭状态。</p>
                                <pre><code>private async void FindPaired()
{
PeerFinder.AlternateIdentities["Bluetooth:Paired"] = "";
try
    {
    	var peers = await PeerFinder.FindAllPeersAsync();
}
catch (Exception ex)
    {
    	if ((uint)ex.HResult == 0x8007048F)
        {
        	MessageBox.Show("Bluetooth is turned off");
        }
}
}</code></pre>
                                <p>
                                    更多有关Windows
Phone蓝牙的内容，请参考<a
    href="http://msdn.microsoft.com/zh-cn/library/windowsphone/develop/jj207007(v=vs.105).aspx"
    title="Windows Phone 8 的蓝牙">Windows
Phone 8 的蓝牙</a>
                                </p>
                                <h1><a name="_Toc372744257"></a><a>邻近感应</a></h1>
                                <p>Windows Phone 8 支持使用近场通信 (NFC) 的邻近通信。</p>
                                <h2><a name="_Toc372744258">邻近感应 API</a></h2>
                                <p>Windows Phone NFC API：</p>
                                <table>
                                    <tr>
                                        <td>
                                            <p>PeerFinder</p>
                                        </td>
                                        <td>
                                            <p>使您可以在邻近设备上发现您应用程序的另一个实例，并使用点击笔势或浏览在对等类应用程序之间创建套接字连接。对等方应用是运行在另一设备上的另一应用实例。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ProximityDevice</p>
                                        </td>
                                        <td>
                                            <p>使您的应用能够与 3-4 厘米左右内的其他设备通信，并且在点击期间交换小的数据负载。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>PeerInformation</p>
                                        </td>
                                        <td>
                                            <p>包含标识对等类的信息。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ProximityMessage</p>
                                        </td>
                                        <td>
                                            <p>表示从订阅收到的消息。</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ConnectionRequestedEventArgs</p>
                                        </td>
                                        <td>
                                            <p>
                                                包含通过 ConnectionRequested
  事件传递给应用程序的属性。
                                            </p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>TriggeredConnectionStateChangedEventArgs</p>
                                        </td>
                                        <td>
                                            <p>
                                                包含
  TriggeredConnectionStateChanged 事件传递给应用程序的属性。
                                            </p>
                                        </td>
                                    </tr>
                                </table>
                                <h2><a name="_Toc372744259">应用场合</a></h2>
                                <h3><a name="_Toc372744260">1</a>、<b>企业中的应用</b></h3>
                                <p>
                                    各种有意使用智能手机作为下一代门禁卡的机构正在对NFC进行技术测试，这是一种理想的企业应用。
                                </p>
                                <p>
                                    员工还可以利用NFC智能手机和其它设备进入员工停车场或食堂并支付费用。NFC标签可以被放置在会议室内部，与会者就可以在标签前挥动自己的兼容手机使其静音或打开Wi-Fi，或者通过NFC进行蓝牙配对，并进行数据传输。NFC技术也可以将URI方案通过NFC传输到另一台与其配对的手机上，如果另一台手机上面注册了相关联的应用，则<a
                                        name="3_2"></a><a name="sub5282340_3_2"></a>会以对本地启动 URI 相同的方式来处理 URI 关联，启动相对应的应用。
                                </p>
                                <p><b>2</b><b>、政府部门的应用</b></p>
                                <p>
                                    政府还可以利用NFC来改善公共服务、提高运输系统及其它。一些城市和郊区已经开始使用NFC为居民提供更好的服务和改善生活质量。NFC技术的出现让用户可以用智能手机或移动设备支付车费、进入停车场及支付费用、进入游泳池或图书馆等公共设施。
                                </p>
                                <p>
                                    法国移动非接触式协会(AFSCM)在NFC服务方面处于领先地位。据该组织称，法国是欧洲其中一个NFC手机用户最多的国家。AFCSM预计，到2012年底将会有250万法国公民使用NFC设备。法国的“Cityzi”服务使用该国某些地方的用户可以通过快速扫描手机进入火车站，还可以在随处可见的NFC标签上挥动设备获取地图、产品信息或服务。旧金山市有约3万个NFC兼容的停车计时器。澳大利亚悉尼使用NFC标签来引导岩石区的游客。
                                </p>
                                <h3><a name="_Toc372744261"></a><a name="3_3"></a><a name="sub5282340_3_3"></a><b>2</b><b>、与零售购物体验</b></h3>
                                <p>
                                    NFC可以通过结合无线优惠券、会员卡和支付选择扩展和提升现代购物体验。消费者可以用个人应用程序扫描产品货架上的NFC标签，获得关于该产品更加个性化的信息。举个例子，如果你对坚果过敏，通过扫描产品，你的NFC设备能自动检测出该产品是否含有坚果并做出提醒。通过触碰NFC标签来获得信息、增加到购物篮、获得优惠券和其它新的用途将对零售业产生越来越大的影响。
                                </p>
                                <h3><a name="_Toc372744262"></a><a name="3_4"></a><a name="sub5282340_3_4"></a><b>3</b><b>、与市场营销</b></h3>
                                <p>
                                    NFC技术对于现代市场营销商有着深远的影响。例如，用户只需用NFC手机在NFC海报、广告、广告牌或电影海报上挥一挥就可以立即获得产品或服务的信息。
                                </p>
                                <p>
                                    商家可以把NFC标签放在店门口，那么用户就可以自动登录Foursquare或者Facebook等社交网络、和朋友分享细节或好东西。比利时的Walibi游乐园推出了首个NFC系统，名为“Walibi Connect”，用户可以扫描NFC腕带来自动发送更新或关于喜欢的活动和景点到Facebook网页。在食品服务方面，酒吧和餐馆可以从一家名为RadipNFC的订购NFC杯垫和其它促销材料，让顾客可以扫描它们获得该店或广告商的更多信息。
                                </p>
                                <h3><a name="_Toc372744263"></a><a name="3_5"></a><a name="sub5282340_3_5"></a><b>4</b><b>、设备之间共享</b></h3>
                                <p>
                                    NFC还可以作为一种短程技术，当几部设备离得非常近的时候，文件和其它内容就可以在这些设备中传递。这项功能对于需要协作的场所非常有用，如需要分享文件或多个玩家进行游戏的时候。同时，也可以让两个用户使用NFC连接来进行名片交换，比传统的名片或者手动输入通讯录方便快捷。
                                </p>
                                <h3><a name="_Toc372744264"></a><a name="3_6"></a><a name="sub5282340_3_6"></a><b>5</b><b>、安防领域应用</b></h3>
                                <p>
                                    近距离无线通信(NFC)是一项适用于门禁系统的技术，这种近距离无线通信标准能够在几厘米的距离内实现设备间的数据交换。NFC还完全符合管理非接触式智能卡的ISO标准，这是其成为理想平台的一大显著特点。通过使用配备NFC技术的手机携带便携式身份凭证卡，然后以无线方式由读卡器读取，用户只需在读卡器前出示手机即可开门。
                                </p>
                                <p>
                                    NFC虚拟凭证卡的最简单模式就是复制现行卡片内的门禁原则。手机将身份信息传递给读卡器，后者又传送给现有的门禁系统，最后打开门。这样，无需使用钥匙或智能卡，就可提供更安全、更便携的方式来配置、监控和修改凭证卡安全参数，不仅消除了凭证卡被复制的风险，而且还可在必要时临时分发凭证卡，若丢失或被盗也可取消凭证卡。
                                </p>
                                <br />
                                <h2><a name="_Toc372744265">代码示例</a></h2>
                                <h3><a name="_Toc372744266">发送和接收 NFC 消息</a></h3>
                                <h4>发送消息</h4>
                                <p>Windows Phone 应用一次仅支持一个 WriteTag 消息。在您可以发布新的 WriteTag 消息之前，您应该停止发布任何现有消息。</p>
                                <pre><code>ProximityDevice device = ProximityDevice.GetDefault();
if (device!= null)
{
  long Id = device.PublishMessage("Windows.SampleMessageType", "Hello World!");
  Debug.WriteLine("Published Message. ID is {0}", Id);
}</code></pre>
                                <h4>接收消息</h4>
                                <pre><code>ProximityDevice device = ProximityDevice.GetDefault();
if (device!= null)
{
  long Id = device.SubscribeForMessage ("Windows.SampleMessageType", messageReceived);
  Debug.WriteLine("Published Message. ID is {0}", Id);
}

private void messageReceived(ProximityDevice sender, ProximityMessage message)
{
  Debug.WriteLine("Received from {0}:'{1}'", sender.DeviceId, message.DataAsString);
}</code></pre>
                                <h3><a name="_Toc372744267">查找 Windows Phone 对等方应用</a></h3>
                                <h4>开始查找对等方</h4>
                                <pre><code>ProximityDevice device = ProximityDevice.GetDefault();
if (device!= null)
{
  PeerFinder.TriggeredConnectionStateChanged += OnTriggeredConnectionStateChanged;
  PeerFinder.Start();
}</code></pre>
                                <h4>处理连接状态变化</h4>
                                <pre><code>StreamSocket _streamSocket;
void OnTriggeredConnectionStateChanged(object sender, TriggeredConnectionStateChangedEventArgs args)
{
    switch (args.State)
    {
        case TriggeredConnectState.Listening:
            break;
         case TriggeredConnectState.PeerFound:
             break;
         case TriggeredConnectState.Connecting:
            break;
          case TriggeredConnectState.Completed:
            _streamSocket = args.Socket;
             break;
         case TriggeredConnectState.Canceled:
              break;
         case TriggeredConnectState.Failed:
             break;
       }
}</code></pre>
                                <h4>查找 Windows 8 对等方应用</h4>
                                <p>若要查找其他平台（如 Windows 8）上的对等方应用，则必须首先定义您的应用在该平台上的备用应用 ID。</p>
                                <pre><code>ProximityDevice device = ProximityDevice.GetDefault();
if (device != null)
{
  PeerFinder.AlternateIdentities.Add("Windows", "my Win8 appID");
  PeerFinder.TriggeredConnectionStateChanged += OnTriggeredConnectionStateChanged;
  PeerFinder.Start();
}</code></pre>
                                <p><b>对于</b><b>Windows Store</b><b>应用程序</b></p>
                                <p>使用邻近功能在进行点击手势过程中快速交换数据，或者使用点击借助基础结构网络、Wi-Fi Direct 或 Bluetooth 设置长期的信道。</p>
                                <p>
                                    属于
Windows.Networking.Proximity 命名空间的 Windows 运行时中的类支持邻近。你可以使用 ProximityDevice 类与 3-4 厘米范围内的其他计算机通信，并且在点击过程中交换负载小的数据。你可以使用 PeerFinder 类与对等应用进行通信，并设置长期套接字连接。对等应用是运行在另一台计算机上的应用的另一个实例。
                                </p>
                                <p>例如，如下代码使用 ProximityDevice 类的 GetDefault 静态方法为本地计算机获取对邻近设备的引用。通过将事件处理程序与 DeviceArrived 和 DeviceDeparted 事件进行关联，你可以知道设备何时进入或离开邻近感应。</p>
                                <pre><code>Windows.Networking.Proximity.ProximityDevice proximityDevice;

public MainPage()
{
    InitializeComponent();

    proximityDevice = Windows.Networking.Proximity.ProximityDevice.GetDefault();

    if (proximityDevice != null)
    {
        proximityDevice.DeviceArrived += ProximityDeviceArrived;
        proximityDevice.DeviceDeparted += ProximityDeviceDeparted;
    }
    else
    {
        MessageTextBlock.Text += "Failed to initialize proximity device.\n";
    }
}

Windows.UI.Core.CoreDispatcher _dispatcher = Window.Current.Dispatcher;

private async void ProximityDeviceArrived(object sender)
{
await _dispatcher.RunAsync(Windows.UI.Core.CoreDispatcherPriority.Normal,
() =>
{
            MessageTextBlock.Text += "Proximate device arrived.\n";
});
}

private async void ProximityDeviceDeparted(object sender)
{
await _dispatcher.RunAsync(Windows.UI.Core.CoreDispatcherPriority.Normal,
() =>
{
            MessageTextBlock.Text += "Proximate device departed.\n";
});
}</code></pre>
                                <h2><a name="_Toc372744268">如何确定是否支持邻近功能</a></h2>
                                <p>可以通过以下方式确定是否已安装支持邻近感应的设备：检查 PeerFinder.SupportedDiscoveryTypes 属性以查看是否支持 Triggered 连接，检查 GetDefault 方法是否返回 NULL，或者获取所有邻近设备列表并确保列表至少列出一台设备。</p>
                                <h2><a name="_Toc372744269">使用邻近感应激活应用</a></h2>
                                <p>
                                    当你使用
PeerFinder 并点击以将应用连接到另一台计算机上的对等应用时，如果该应用尚未运行或未在前台运行，Windows 将提示另一台计算机的用户激活该应用。如果该应用已在前台运行，将在不首先提示用户的情况下引发激活事件。你也可以通过调用接受一个字符串参数的 PeerFinder.Start 方法重载来激活未在前台运行的应用。Start 方法的字符串参数包含发送到对等应用的消息。该应用将通过传递到激活参数的消息激活。
                                </p>
                                <p>
                                    当你使用点击手势激活对等应用时，将激活应用，并且激活 Kind 是
Launch。如果你通过使用
PeerFinder.Start 方法发送消息来激活应用，可以从启动参数的 Arguments 属性检索消息文本。如果为了打开 StreamSocket 而激活你的应用，则 Arguments 属性将返回字符串 Windows.Networking.Proximity.PeerFinder:StreamSocket。在此情况下，将 TriggeredConnectionStateChanged
属性设置为适当的事件处理程序，并调用
PeerFinder.Start 方法完成套接字连接。以下示例摘自快速入门：使用点击或浏览连接应用程序中的示例代码，并依赖 OnLaunched 事件中的代码传递启动参数。
                                </p>
                                <pre><code>protected override void OnNavigatedTo(NavigationEventArgs e)
{
    DisplayNameTextBox.Text = Windows.Networking.Proximity.PeerFinder.DisplayName;
    Windows.Networking.Proximity.PeerFinder.ConnectionRequested += ConnectionRequested;

    // If activated from launch or from the background, create a peer connection.
    var args = e.Parameter as Windows.ApplicationModel.Activation.LaunchActivatedEventArgs;
    if (args != null && args.Kind == Windows.ApplicationModel.Activation.ActivationKind.Launch)
    {
        if (args.Arguments == "Windows.Networking.Proximity.PeerFinder:StreamSocket")
        {
            AdvertiseForPeersButton_Click(null, null);
        }
    }
}</code></pre>
                                <p><b>对于</b><b>Android</b><b>应用程序</b></p>
                                <p>
                                    Android应用程序的NFC支持主要在android.nfc和android.nfc.tech两个包中，其一共分为<a
                                        href="http://developer.android.com/guide/topics/connectivity/nfc/nfc.html">NFC
Basics</a>、<a
    href="http://developer.android.com/guide/topics/connectivity/nfc/advanced-nfc.html">Advanced
NFC</a>和<a
    href="http://developer.android.com/guide/topics/connectivity/nfc/hce.html">Host-based
Card Emulation</a>三种使用方式。
                                </p>
                            </div>
                            <div>
                                <hr class="msocomoff" size="1" width="33%">
                                <div>
                                    <div id="_com_1" class="msocomtxt" language="JavaScript"
                                        onmouseover="msoCommentShow('_anchor_1','_com_1')"
                                        onmouseout="msoCommentHide('_com_1')">
                                        <a name="_msocom_1"></a>
                                        <p class="MsoCommentText">
                                            &nbsp;<a
                                                href="#_msoanchor_1" class="msocomoff">[BW(TDLXX1]</a>这里最好的方法是结合demo
                                        </p>
                                        <p class="MsoCommentText">&nbsp;</p>
                                        <p class="MsoCommentText">这一节内容非常重要。</p>
                                        <p class="MsoCommentText" style='margin-left: 18.0pt;'>
                                            1.&nbsp;
需要一个 Win8 和 WP8 通过本地WIFI链接的demo&nbsp;
//问问leon
                                        </p>
                                        <p class="MsoCommentText" style='margin-left: 18.0pt;'>
                                            2.&nbsp;
介绍NFC能做的事情，结合启动器，（商店，通讯录，蓝牙和WIFI匹配等功能）
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
        <!--End Content-->
        <div style="text-align: right" class="gotoTop"><a href="javascript:scroll(0,0)"></a></div>
        <!--Begin ProudctLinks-->
        <div class="ms-pro-links">
            <div class="grid-container clearfix">
                <div class="cam-links">
                    其它微软站点
		<a href="http://www.microsoft.com/zh-cn/default.aspx">微软中国官方网站</a>
                    <a href="http://www.microsoft.com/zh-cn/download/default.aspx?WT.mc_id=MSCOM_zh-cn_HP_Footer_downloads" target="_blank">微软中国下载中心</a>
                    <a href="http://www.microsoftstore.com.cn?WT.mc_id=MSCOM_003" target="_blank">微软中国官方商城</a>
                    <a href="http://www.microsoft.com/china/newsletter/" target="_blank">订阅电子期刊</a>
                    <a href="https://sales.liveperson.net/hc/21661174/?cmd=file&file=visitorWantsToChat&site=21661174&byhref=1&SESSIONVAR!skill=APGC.PRC.ZH.CS.CON.PRESLS.GENERAL" target="_blank">联系微软销售代表</a>
                    <a href="http://www.microsoft.com/zh-cn/sitemap.aspx" target="_blank">网站地图</a>
                </div>
            </div>
        </div>
        <!--End ProudctLinks-->
        <!--Begin footer-->
        <div class="footer">
            <div class="grid-container">
                <img src="http://i.s-microsoft.com/global/ImageStore/PublishingImages/logos/hp/logo-type-1x.png" alt="microsoft" class="logo">
                <ul>
                    <li><a href="http://www.miibeian.gov.cn/" title="">京ICP备09042378号-6</a></li>
                    <li><a href="https://profile.microsoft.com/RegSysProfileCenter/default.aspx?lcid=2052" title="">个人信息中心</a></li>
                    <li><a href="http://support.microsoft.com/contactus/?ws=support" title="">与我们联系</a></li>
                    <li><a href="http://go.microsoft.com/fwlink/?LinkId=248681" title="">隐私权声明</a></li>
                    <li><a href="http://go.microsoft.com/?linkid=4412892" title="">使用条款</a></li>
                    <li><a href="http://www.microsoft.com/About/Legal/EN/US/IntellectualProperty/Trademarks/EN-US.aspx" title="">商标</a></li>
                    <li>&copy; 2013 Microsoft</li>
                </ul>
            </div>
        </div>
        <!--End footer-->
        <!-- Begin MDA WEDCS -->
        <script type="text/JavaScript">
            var varSegmentation = 0;
            var varClickTracking = 1;
            var varCustomerTracking = 1;
            var varAutoFirePV = 1;
            var Route = "#";
            var Ctrl = "#"
            //document.write("<script type='text/javascript' src='" + window.location.protocol + "//c.microsoft.com/ms.js'><"+"/script>");
        </script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="./assets/js/script.js"></script>
        <script type="text/javascript" src="./js/siteSearch.js"></script>
        <noscript>
            <img alt="" width="1" height="1" src="http://c.microsoft.com/trans_pixel.aspx/" />
        </noscript>
        <!-- Begin MDA WEDCS -->
    </div>
</body>
</html>
